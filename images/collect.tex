---
---

\matrix (A) [collection] {
    \node (a1) {$a_1$}; &
    \node (a2) {$a_2$}; &
    \elementsbetween &
    \node (ai) {$a_i$}; &
    \node (ai+1) {$a_{i+1}$}; &
    \elementsbetween &
    \node (an-1) {$a_{n-1}$}; &
    \node (an) {$a_n$}; \\
};

\matrix [collection, below=3 of A] {
    \node (b2) {$b_1$}; &
    \elementsbetween &
    \node (bi) {$b_j$}; &
    \elementsbetween &
    \node (bn-1) {$b_m$}; \\
};

\foreach \i in {1,2,i,i+1,n-1,n}{
    \node (f\i) [subfunction, below=1 of a\i] {\texttt{f}};
    \draw [flow ->] (a\i) -- (f\i.north io 1);
}
\foreach \i in {2,i,n-1}{
    \draw [flow ->] (f\i.south io 1) .. controls +(0, -1) and +(0, 1) ..
        node [partial, very near start] {} (b\i.north);
}

\draw [throw ->] (f1.west) -- +(-.5, 0)
    node [exception=MatchError, font=\tiny, left];
\draw [throw ->] (fi+1.east) -- +(.5, 0)
    node [exception=MatchError, font=\tiny, right];
\draw [throw ->] (fn.east) -- +(.5, 0)
    node [exception=MatchError, font=\tiny, right];
