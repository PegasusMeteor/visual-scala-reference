---
---

\matrix (A) [collection] {
    \node (a1) {$a_1$}; &
    \node (a2) {$a_2$}; &
    \elementsbetween &
    \node (ai) {$a_i$}; &
    \elementsbetween[3.5] &
    \node (an) {$a_n$}; \\
};

\foreach \i in {1,2,i,n}{
    \node (f) [subfunction, above=.5 of a\i] {\texttt{f}};
    \node (b\i) [subelement, above=.5 of f] {$b_\i$};
    \draw [subflow] (a\i) -- (f.south io 1);
    \draw [subflow] (f.north io 1) -- (b\i);
}

\node (b) [element, below=2 of ai] {$a_i$};
\draw [flow] (ai) -- (b);

\matrix [matrix of math nodes, nodes={inner ysep=.125\masterunit}, row sep=.125\masterunit, left delimiter=\{, right=.5 of bi] {
  b_i < b_j,\, j \in [1, i - 1] \\
  b_i \leq b_k,\, k \in [i + 1, n] \\
};

