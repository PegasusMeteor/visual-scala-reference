\newlength{\defaultpenwidth}
\setlength{\defaultpenwidth}{0.04\masterunit}

\definecolor{defaultpencolor}{RGB}{43, 43, 43}

\tikzset{every path/.style={
    draw=defaultpencolor,
}}

\tikzset{every node/.style={
    inner sep=0pt,
    outer sep=0pt,
    node distance=0,
    text=defaultpencolor,
}}

\tikzset{element/.style={
    font=\large,
    inner sep=0.1\masterunit,
}}

\tikzset{subelement/.style={
    font=\small,
    inner sep=0.1\masterunit,
}}

\tikzset{collection element line width/.style={
    line width=\defaultpenwidth,
}}

\tikzset{subcollection element line width/.style={
    line width=.75\defaultpenwidth,
}}

\tikzset{collection element/.style={
    collection element line width,
    draw,
    element,
    inner sep=0,
    minimum height=\masterunit,
    minimum width=\masterunit,
}}

\tikzset{collection/.style={
    column sep=-\defaultpenwidth,
    nodes={
        collection element,
    },
    outer sep=-0.5\defaultpenwidth,
    row sep=-\defaultpenwidth,
}}

\tikzset{subcollection/.style={
    collection,
    row sep=-0.75\defaultpenwidth,
    nodes={
        subcollection element line width,
        minimum width=.75\masterunit,
        minimum height=.75\masterunit,
        font=\small,
    },
}}

\tikzset{empty collection/.style={
    decorate,
    decoration={
        amplitude=0.025\masterunit,
        angle=45,
        border,
        segment length=0.05\masterunit,
    },
    draw,
    line width=.3\defaultpenwidth,
    minimum height=\masterunit,
    minimum width=0.3\masterunit,
    node contents={}
}}

\tikzset{tuple of collections/.style={
    collection,
    inner sep=.25\masterunit,
    left delimiter=(,
    right delimiter=),
}}

\tikzset{tuple separator/.style={
    draw=none,
    minimum width=0,
    text height=\masterunit,
    font=\Huge,
    node contents={\,,\,\,},
}}

\tikzset{option/.style={
    draw,
    line width=0.75\defaultpenwidth,
    inner sep=0.1\masterunit
}}

\tikzset{some/.style={
    element,
    option,
    rectangle split,
    rectangle split parts=2,
    rectangle split draw splits=false,
    node contents=\some{#1}
}}

\tikzset{none/.style={
    option,
    node contents={\none}
}}

\newcommand\some[1]{
    \footnotesize{Some} \nodepart{two} #1
}
\newcommand\none{
    \footnotesize{None}
}

\tikzset{exception/.style={
    draw,
    line width=.02\masterunit,
    decorate,
    decoration={
        zigzag,
        segment length=0.1\masterunit,
        amplitude=0.0125\masterunit,
    },
    inner sep=.1\masterunit,
    node contents=#1
}}

\tikzset{flow width/.style={
    line width=0.75\defaultpenwidth,
}}

\tikzset{flow/.style={
    -{Triangle[flex,fill=defaultpencolor, angle'=30]},
    flow width,
}}

\tikzset{inverse flow/.style={
    {Triangle[flex,fill=defaultpencolor, angle'=30]}-,
    flow width,
}}

\tikzset{bridge flow/.pic={
    \fill [white] circle [radius=.09\masterunit];
    % \draw [flow, -, color=gray, draw opacity=.25] (-.1\masterunit, 0) arc [start angle=180, end angle=360, x radius=.1\masterunit, y radius=.05\masterunit];
    \draw [flow, -] (-.1\masterunit, 0) arc [start angle=180, end angle=0, radius=.1\masterunit];
}}

\tikzset{subflow width/.style={
    line width=0.5\defaultpenwidth,
}}

\tikzset{subflow/.style={
    flow,
    subflow width,
}}

\tikzset{solid dashed solid/.style={
    /utils/exec=\csname tikz@options\endcsname,
    decorate,
    decoration={
        show path construction,
        lineto code={
            \path [tips=false] coordinate (_a) at ($ (\tikzinputsegmentfirst)!.15!(\tikzinputsegmentlast) $);
            \path [tips=false] coordinate (_b) at ($ (\tikzinputsegmentfirst)!.85!(\tikzinputsegmentlast) $);
            \draw [tips=false, solid] (\tikzinputsegmentfirst) -- (_a);
            \draw [tips=false, dashed] (_a) -- (_b);
            \draw [solid] (_b) -- (\tikzinputsegmentlast);
        }
    },
}}

\tikzset{solid dashed/.style={
    /utils/exec=\csname tikz@options\endcsname,
    decorate,
    decoration={
        show path construction,
        lineto code={
            \path [tips=false] coordinate (_a) at ($ (\tikzinputsegmentfirst)!.4!(\tikzinputsegmentlast) $);
            \draw [tips=false, solid] (\tikzinputsegmentfirst) -- (_a);
            \draw [dashed] (_a) -- (\tikzinputsegmentlast);
        }
    },
}}

\tikzset{dashed solid/.style={
    /utils/exec=\csname tikz@options\endcsname,
    decorate,
    decoration={
        show path construction,
        lineto code={
            \path [tips=false] coordinate (_a) at ($ (\tikzinputsegmentfirst)!.6!(\tikzinputsegmentlast) $);
            \draw [tips=false, dashed] (\tikzinputsegmentfirst) -- (_a);
            \draw [solid] (_a) -- (\tikzinputsegmentlast);
        }
    },
}}


\newcommand{\elementsbefore}{
    \node (_e) [draw=none, minimum width=.75\masterunit] {};
    \draw [collection element line width, dashed solid]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\newcommand{\elementsbetween}[1][1.5]{
    \node (_e) [draw=none, minimum width=#1\masterunit] {};
    \draw [collection element line width, solid dashed solid]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\newcommand{\elementsafter}{
    \node (_e) [draw=none, minimum width=.75\masterunit] {};
    \draw [collection element line width, solid dashed]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\newcommand{\velementsbetween}{
    \node (_e) [draw=none, minimum height=1.5\masterunit] {};
    \draw [collection element line width, solid dashed solid]
        (_e.north west) -- (_e.south west)
        (_e.north east) -- (_e.south east);
}

\newcommand{\subelementsbefore}{
    \node (_e) [draw=none, minimum width=\masterunit] {};
    \draw [subcollection element line width, dashed solid]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\newcommand{\subelementsbetween}{
    \node (_e) [draw=none, minimum width=\masterunit] {};
    \draw [subcollection element line width, solid dashed solid]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\newcommand{\subelementsafter}{
    \node (_e) [draw=none, minimum width=\masterunit] {};
    \draw [subcollection element line width, solid dashed]
        (_e.north west) -- (_e.north east)
        (_e.south west) -- (_e.south east);
}

\tikzset{key to value/.style={
    collection element line width,
    decorate,
    decoration={
        show path construction,
        lineto code={
            /utils/exec=\csname tikz@options\endcsname,
            \fill (\tikzinputsegmentfirst) [white] circle [radius=.15\masterunit];
            \draw ($ (\tikzinputsegmentfirst) + (0, .15\masterunit) $) [draw, line cap=rect] arc [start angle=90, end angle=270, radius=.15\masterunit];
            
            \fill [defaultpencolor] (\tikzinputsegmentfirst) circle [radius=.05\masterunit];
            \draw (\tikzinputsegmentfirst) [flow, defaultpencolor, -Triangle] -- (\tikzinputsegmentlast);
        }
    }
}}

\tikzset{function/.style={
    shape=function,
    line width=.75\defaultpenwidth,
    minimum width=.75\masterunit,
    minimum height=.75\masterunit,
}}

\tikzset{subfunction/.style={
    shape=function,
    inner xsep=.15\masterunit,
    inner ysep=.2\masterunit,
    line width=.5\defaultpenwidth,
}}

\tikzset{partial function/.style={
    dash pattern=on .3 off .6,
}}

\tikzset{normal brace/.style={
    decorate,
    decoration={
        brace,
        amplitude=.2\masterunit,
        raise=.2\masterunit,
    }
}}

\tikzset{inverse brace/.style={
    normal brace,
    decoration={
        mirror,
    }
}}

\newcommand\normalbrace[2]{
    \draw [normal brace] (#1) -- (#2);
    \coordinate (bracepoint) at ($ (#1)!.5!(#2) + (0, .4) $);
}

\newcommand\inversebrace[2]{
    \draw [line width=\pgflinewidth, inverse brace] (#1) -- (#2);
    \coordinate (bracepoint) at ($ (#1)!.5!(#2) + (0, -.4) $);
}

\tikzset{measure width/.style={
    line width=0.02\masterunit,
}}

\tikzset{measure/.style={
    measure width,
    -{Triangle[angle'=30]},
}}

\newcommand\topmeasure[3]{
    \draw [measure width]
        (#2) -- ++(0, .6)
        (#3) -- ++(0, .6);
    \coordinate (_m1) at ($ (#2) + (0, .5) $);
    \coordinate (_m2) at ($ (#3) + (0, .5) $);
    \node [outer sep=.1\masterunit] (_mn) at ($ (_m1)!.5!(_m2) $) {#1};
    \draw [measure] (_mn) -- (_m1);
    \draw [measure] (_mn) -- (_m2);
}

\newcommand\bottommeasure[3]{
    \draw [measure width]
        (#2) -- ++(0, -.6)
        (#3) -- ++(0, -.6);
    \coordinate (_m1) at ($ (#2) + (0, -.5) $);
    \coordinate (_m2) at ($ (#3) + (0, -.5) $);
    \node [outer sep=.1\masterunit] (_mn) at ($ (_m1)!.5!(_m2) $) {#1};
    \draw [measure] (_mn) -- (_m1);
    \draw [measure] (_mn) -- (_m2);
}

\newcommand\bottomrightmeasure[3]{
    \draw [measure width]
        (#2) -- ++(0, -.6)
        (#3) -- ++(0, -.6);
    \coordinate (_m1) at ($ (#2) + (0, -.5) $);
    \coordinate (_m2) at ($ (#3) + (0, -.5) $);
    \node [outer sep=.1\masterunit, anchor=south west] (_mn) at (_m2) {#1};
    \draw [measure] ($ (_m1) + (-.5, 0) $) -- (_m1);
    \draw [measure] (_mn.south east) -- (_m2);
}

\tikzset{big arrow/.style={
  draw,
  line width=\defaultpenwidth,
  minimum height=.4\masterunit,
  minimum width=.3\masterunit,
  node contents={},
  single arrow,
  single arrow tip angle=60,
  single arrow head extend=.02\masterunit,
}}

\newcommand{\drawbg}{
     \begin{scope}[on background layer]
         \coordinate (_a) at ($ (current bounding box.south west) + (-.5, -.5) $);
         \coordinate (_b) at ($ (current bounding box.north east) + (.5, .5) $);
         \fill [white] (_a) rectangle (_b);
     \end{scope}
}
