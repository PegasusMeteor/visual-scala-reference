\input{_header.tex}

\matrix (A) [collection] {
  \node (a1) {$a_1$}; &
  \helem{between}          &
  \node (ai) {$a_{n-i}$}; &
  \helem{between}          &
  \node (an-1) {$a_{n-1}$}; &
  \node (an) {$a_n$}; \\
};

\matrix (B) [collection, below=5.5\cellheight of A] {
  \node (zn) {$z_n$}; &
  \helem{between}          &
  \node (zi+1) {$z_{i+1}$}; &
  \helem{between}          &
  \node (z2) {$z_2$}; &
  \node (z1) {$z_1$}; &
  \node (z0) {\param{z}}; \\
};

\node (z) [right=\cellwidth of A] {\param{z}};

\begin{scope}
  \tikzstyle{every node}=[internal operation, anchor=north]
  \node (op1) [below right=\cellheight and -.5\cellwidth of an] {$\param{op}(a_n, \param{z})$};
  \node (op2) [below left=2\cellheight and 0 of an-1, anchor=north] {$\param{op}(a_{n-1}, z_1)$};
  \node (opi) [below=3\cellheight of ai] {$\param{op}(a_{n-i}, z_i)$};
  \node (opn) [below=4\cellheight of a1] {$\param{op}(a_1, z_{n-1})$};
\end{scope}

\begin{scope}
  \tikzstyle{every path}=[arrow]
  \draw (z.south) .. controls +(0, -1) and +(0, 1) .. (op1.35);
  \draw (z.south) .. controls +(0, -5) and +(0, 5) .. (z0.north); 
  \draw (an.south) [smooth] to (op1.95);
   
  \draw (an-1.south) [smooth] to (op2.95);
  \draw (op1.west) .. controls +(-.5, 0) and +(0, 1) .. (op2.30); 
  \draw (op1.west) .. controls +(-.5, 0) and +(0, 1) .. (z1.north); 
   
  \draw (ai.south) [smooth] to (opi.95);
  \draw (op2.west) [middle dots] .. controls +(-.5, 0) and +(0, .5) .. (opi.30); 
  \draw (op2.west) .. controls +(-.5, 0) and +(0, 1) .. (z2.north); 

  \draw (a1.south) [smooth] to (opn.120);
  \draw (opi.west) .. controls +(-.5, 0) and +(0, 1) .. (opn.35); 
  \draw (opi.west) .. controls +(-.5, 0) and +(0, 1) .. (zi+1.north); 
   
  \draw (opn) [out=180, in=90, arrow] to (zn); 
\end{scope}

\input{_footer.tex}
