\input{_header.tex}

\matrix (A) [collection, name prefix=a] {
  \node (1) {$a_1$};       &
  \ellipsis;               &
  \node (i) {$a_i$};       &
  \ellipsis;               &
  \node (n-1) {$a_{n-1}$}; &
  \node (n) {$a_n$};       \\
};

\matrix (B) [collection, matrix anchor=bz.west, below of=A, node distance=7cm] at (an.east) {
  \node (bn) {$b$};          &
  \ellipsis;                 &
  \node (bi) {$z_i$};        &
  \ellipsis;                 &
  \node (b2) {$z_2$};        &
  \node (b1) {$z_1$};        &
  \node (bz) {$\param{z}$}; \\
};

\node (z) [above=61mm of bz] {\param{z}};

\node (f1) [above=4cm of b1] {$\param{op}(a_n, \textrm{z})$};
\node (f2) [above=3cm of b2] {$\param{op}(a_{n-1}, z_1)$};
\node (fi) [above=2cm of bi] {$\param{op}(a_i, z_{i-1})$};
\node (fn) [above=1cm of bn] {$\param{op}(a_n, z_{n-1})$};

\begin{scope}
  \tikzstyle{every path}=[arrow, smooth]
  \draw (z) edge (bz) edge ([xshift=1em] f1.north);

  \draw (an) to ([xshift=-0.2em] f1.north);
  \draw (f1) edge (b1) edge ([xshift=1.4em] f2.north);

  \draw (an-1) to ([xshift=-0.2em] f2.north);
  \draw (f2) edge (b2) edge [middotted] ([xshift=1em] fi.north);

  \draw (ai) to ([xshift=-0.8em] fi.north);
  \draw (fi) edge (bi) edge [middotted] ([xshift=1em] fn.north);

  \draw (a1) to ([xshift=-1em] fn.north);
  \draw (fn) edge (bn);
\end{scope}

\input{_footer.tex}
