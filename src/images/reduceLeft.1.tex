\input{_header.tex}

\matrix (A) [collection] {
  \elem{a}{1} &
  \elem{a}{2} &
  \elem{a}{3} &
  \helem{between} &
  \elem{a}{i} &
  \helem{between} &
  \elem{a}{n} \\
};

\begin{scope}
  \tikzstyle{every node}=[internal operation]
  \node (op1) [below=\cellheight of a1] {$\param{op}(a_1, a_2)$};
  \node (op2) [below=2\cellheight of a3] {$\param{op}(z_1, a_3)$};
  \node (opi) [below=3\cellheight of ai] {$\param{op}(z_{i-2}, a_i)$};
  \node (opn) [below=4\cellheight of an] {$\param{op}(z_{n-2}, a_n)$};
\end{scope}

\node (B) [below right=\cellheight and \cellwidth of opn] {$z_{n-1}$};

\begin{scope}
  \tikzstyle{every path}=[arrow, out=270, in=90]
  
  \draw (a1.south) to (op1.100);
  \draw (a2.south) to (op1.35);
  
  \draw (op1.east) [out=0] to (op2.100);
  \draw (a3.south) to (op2.35);
  
  \draw (op2.east) [middle dots, out=0] to (opi.100);
  \draw (ai.south) to (opi.30);

  \draw (opi.east) [middle dots, out=0] to (opn.100);
  \draw (an.south) to (opn.30);

  \draw (opn.east) [out=0] to (B);
\end{scope}

\input{_footer.tex}
