\input{_header.tex}

\matrix (A) [collection] {
  \elem{a}{1} &
  \elem{a}{2} &
  \helem{between} &
  \elem{a}{i} &
  \helem{between} &
  \elem{a}{n} \\
};

\matrix (B) [collection, below=5.5\cellheight of A] {
  \node (z0) {\param{z}}; &
  \elem{z}{1} &
  \elem{z}{2} &
  \helem{between} &
  \elem{z}{i} &
  \helem{between} &
  \elem{z}{n} \\
};

\node (z) [left=\cellwidth of A] {\param{z}};

\begin{scope}
  \tikzstyle{every node}=[internal operation, anchor=north]
  \node (op1) [below=\cellheight of a1.south west] {$\param{op}(\param{z}, a_1)$};
  \node (op2) [below right=2\cellheight and 0 of a2, anchor=north] {$\param{op}(z_1, a_2)$};
  \node (opi) [below=3\cellheight of ai] {$\param{op}(z_{i-1}, a_i)$};
  \node (opn) [below=4\cellheight of an] {$\param{op}(z_{n-1}, a_n)$};
\end{scope}

\begin{scope}
  \tikzstyle{every path}=[arrow]
  \draw (z.south) .. controls +(0, -1) and +(0, 1) .. (op1.95);
  \draw (z.south) .. controls +(0, -5) and +(0, 5) .. (z0.north); 
  \draw (a1.south) [smooth] to (op1.45);

  \draw (op1.east) .. controls +(.5, 0) and +(0, 1) .. (op2.95);
  \draw (op1.east) .. controls +(.5, 0) and +(0, 1) .. (z1);

  \draw (a2.south) [smooth] to (op2.35);
  \draw (op2.east) [middle dots] .. controls +(1, 0) and +(0, 1) .. (opi.95); 
  \draw (op2.east) .. controls +(1, 0) and +(0, 1) .. (z2.north);

  \draw (ai.south) [smooth] to (opi.30);
  \draw (opi.east) .. controls +(1, 0) and +(0, 1) .. (zi.north);
  \draw (opi) [middle dots] .. controls +(2, 0) and +(0, 1) .. (opn.95); 

  \draw (an.south) [smooth] to (opn.25);
  \draw (opn.east) .. controls +(1, 0) and +(0, 1) .. (zn.north); 
\end{scope}

\input{_footer.tex}
