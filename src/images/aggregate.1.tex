\input{_header.tex}

\matrix (A) [collection] {
  \node (a1) {$a_1$}; &
  \node (a2) {$a_2$}; &
  \helem{between} &
  \node (ai) {$a_i$}; &
  \node (ai+1) {$a_{i+1}$}; &
  \helem{between} &
  \node (an-1) {$a_{n-1}$}; &
  \node (an) {$a_n$}; \\
};

\node (z) [left=\cellwidth of A] {\param{z}};

\begin{scope}
  \tikzstyle{every node}=[internal operation]
  \node (f1) [below=1.5 of $(z)!.5!(a1)$]    {$\param{seqop}(\param{z}, a_1)$};
  \node (f2) [below=2.5 of $(a1)!.5!(a2)$]   {$\param{seqop}(z_1, a_2)$};
  \node (f3) [below=1.5 of $(ai)!.5!(ai+1)$] {$\param{seqop}(a_i, a_{i+1})$};
  \node (f4) [below=2.5 of $(an-1)!.5!(an)$] {$\param{seqop}(a_{n-1}, a_n)$};

  \node (f6) [below=2\cellheight of f3]                  {$\param{combop}(z_l, z_m)$};
  \node (f5) at ($(f2)!.5!(f6)$)              {$\param{combop}(z_j, z_k)$};
\end{scope}

\node (B) [below=1 of f6] {$z_n$};

\begin{scope}
  \tikzstyle{every path}=[arrow]
  \draw [out=270, in=95] (z) to (f1.55);
  \draw [out=270, in=90] (a1) to (f1.27);

  \draw [out=270, in=90] (ai) to (f3.80);
  \draw [out=270, in=90] (ai+1) to (f3.25);

  \draw [out=0, in=90] (f1) to (f2.60);
  \draw [out=270, in=90] (a2) to (f2.25);

  \draw [out=0, in=90, middle dots] (f2) to (f5.45);
  \draw [out=180, in=90, middle dots] (f3) to (f5.22);

  \draw [out=270, in=90] (an-1.south) to (f4.70);
  \draw [out=270, in=90] (an.south) to (f4.20);
 
  \draw [out=180, in=90, middle dots] (f4.west) to (f6.23);
  \draw [out=0, in=90, middle dots] (f5.east) to (f6.50);

  \draw (f6) -- (B);
\end{scope}

\input{_footer.tex}
