\input{_header.tex}

\matrix (A) [collection] {
  \node (a1) {$a_1$}; &
  \helem{between}          &
  \node (an-i) {$a_{n-i}$}; &
  \helem{between}          &
  \node (an-1) {$a_{n-1}$}; &
  \node (an) {$a_n$}; \\
};

\node (z) [right=\cellwidth of A] {\param{z}};

\begin{scope}
  \tikzstyle{every node}=[internal operation, anchor=north]
  \node (op1) [below right=\cellheight and 0 of an.south east] {$\param{op}(a_n, \param{z})$};
  \node (op2) [below=2\cellheight of an-1] {$\param{op}(a_{n-1}, z_1)$};
  \node (opi) [below=3\cellheight of an-i] {$\param{op}(a_{n-i}, z_i)$};
  \node (opn) [below=4\cellheight of a1] {$\param{op}(a_1, z_{n-1})$};
\end{scope}

\draw (z.south) [smooth arrow] to (op1.35);
\draw (an.south) [smooth arrow] to (op1.95);
 
\draw (an-1.south) [smooth arrow] to (op2.95);
\draw (op1.west) [arrow] .. controls +(-1, 0) and +(0, 1) .. (op2.30); 
 
\draw (an-i.south) [smooth arrow] to (opi.95);
\draw (op2.west) [arrow, middle dots] .. controls +(-1, 0) and +(0, 1) .. (opi.30); 

\draw (a1.south) [smooth arrow] to (opn.120);
\draw (opi) [out=180, in=90, arrow] to (opn.35); 
 
\node (zn) [below left=\cellheight and \cellwidth of opn] {$z_n$};
\draw (opn) [out=180, in=90, arrow] to (zn); 

\input{_footer.tex}
