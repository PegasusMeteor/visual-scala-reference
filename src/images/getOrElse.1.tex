\input{_header.tex}

\matrix (K) [map] {
  \node (k1)       {$k_1$};     \\
  \node (k2)       {$k_2$};     \\
    \velem{between}                    \\
  \node (ki-1)       {$k_{i-1}$};     \\
  \node (ki)       {$k_i$};     \\
    \velem{after}                    \\
};

\foreach \i/\p in {
  1/\false,
  2/\false,
  i-1/\false,
  i/\true}
{
  \path
    node (p\i) [predicate evaluation, left=.5 of k\i] {$k_\i = \param{elem}?\,\p$}
    (k\i) [predicate evaluation edge] -- (p\i);
  \node (v\i) [right=.5\cellwidth of k\i] {$v_{\i}$};
  \draw (k\i) [maps to] -- (v\i);
}

\begin{scope}
  \tikzstyle{every path}=[iteration, bend right=45]
  \draw ($ (p1.west) + (0, 1) $) to (p1.west);
  \draw (p1.west) to (p2.west);
  \draw (p2.west) [middle dots] to (pi-1.west);
  \draw (pi-1.west) to (pi.west);
\end{scope}

\node (B) [right=\cellwidth of vi] {$v_i$};
\draw (vi) [arrow] -- (B);

\input{_footer.tex}
