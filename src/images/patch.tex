\input{_header.tex}

\matrix (A) [collection] {
  \helem[.5\elementswidth]{before} &
  \elem{a}{i-1} &
  \elem{a}{i} &
  \helem{between} &
  \elem{a}{i+j} &
  \elem{a}{i+j+1} &
  \helem[.5\elementswidth]{after} \\
};

\matrix (T) [collection, right=\cellwidth of A] {
  \node (t1) {$b_1$}; &
  \node (t2) {$b_2$}; &
  \helem{between} &
  \node (tm) {$b_m$}; \\
};

\rightparam{T.east}{\param{that}};

\matrix (B) [collection, below=2\cellheight of A] {
  \helem[.5\elementswidth]{before} &
  \node (bai-1) {$a_{i-1}$}; &
  \node (bt1) {$b_1$}; &
  \node (bt2) {$b_2$}; &
  \helem{between} &
  \node (btm) {$b_m$}; &
  \node (bai+j+1) {$a_{i+j+1}$}; &
  \helem[.5\elementswidth]{after} \\
};

\toppointer{ai.north}{\param{from}}
\measure[-4ex]{\param{replaced}}{ai.south west}{ai+j.south east}

\newlength{\varwidth}
\setlength{\varwidth}{\cellwidth + .5\elementswidth}

\bottombrace[a]{$ (ai-1.south east) - (\varwidth, 0) $}{ai-1.south east}
\topbrace[b]{$ (bai-1.north east) - (\varwidth, 0) $}{bai-1.north east}
\draw (a) [smooth arrow] to (b);

\bottombrace[a]{ai+j+1.south west}{$ (ai+j+1.south west) + (\varwidth, 0) $}
\topbrace[b]{bai+j+1.north west}{$ (bai+j+1.north west) + (\varwidth, 0) $}
\draw (a) [smooth arrow] to (b);

\bottombrace[a]{t1.south west}{tm.south east}
\topbrace[b]{bt1.north west}{btm.north east}
\draw (a) [arrow, erase] .. controls +(0, -2) and +(0, 2) .. (b);

\input{_footer.tex}
