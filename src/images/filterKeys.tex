\input{_header.tex}

\matrix (K) [map] {
  \elem{k}{1} \\
  \elem{k}{2} \\
  \velem{between} \\
  \elem{k}{i} \\
  \elem{k}{i+1} \\
  \velem{between} \\
  \elem{k}{n} \\
};

\foreach \i/\p in {
  1/\true,
  2/\false,
  i/\true,
  i+1/\false,
  n/\true} {
  \path
    node (p\i) [predicate evaluation, left=.5 of k\i] {$\p\,\param{p}(k_{\i})?$}
    (k\i) [predicate evaluation edge] -- (p\i);
  \elem[right=.5\cellwidth of k\i]{v}{\i}
  \draw (k\i) [maps to] -- (v\i);
}

\matrix (F) [map, right=3.5\cellwidth] {
  \node (kf1) {$k_1$}; \\
  \velem{between} \\
  \node (kfi) {$k_i$}; \\
  \velem{between} \\
  \node (kfn) {$k_n$}; \\
};

\foreach \i in {1, i, n} {
  \node (vf\i) [right=.5\cellwidth of kf\i] {$v_\i$};
  \draw (kf\i) [maps to] -- (vf\i);
  \draw (v\i) [shorten <=.25\cellwidth, shorten >=.25\cellwidth, arrow, out=0, in=180] to (kf\i);
}

\input{_footer.tex}
