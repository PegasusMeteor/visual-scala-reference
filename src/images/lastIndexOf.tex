\input{_header.tex}

\matrix (A) [collection] {
  \helem[.5\elementswidth]{before}                 &
  \node (ai)   {$a_i$};     &
  \node (ai+1) {$a_{i+1}$}; &
  \helem{between}                 &
  \node (ai+j-1) {$a_{i+j-1}$}; &
  \node (ai+j) {$a_{i+j}$}; &
  \helem[.5\elementswidth]{after}                \\
};

\draw (ai+j.60) [latex-, out=90, in=270] to +(2, 1) node [above] {\param{end}};

\foreach \i/\p/\d in {
  i+j/\false/.75,
  i+j-1/\false/.25,
  i+1/\false/.25,
  i/\true/.75}
{
  \path
    node (p\i) [scale=0.8, predicate evaluation, above=\d of a\i] {$\param{elem} = a_{\i}? \, \p$}
    (a\i) [predicate evaluation edge] -- (p\i);
}

\begin{scope}
  \tikzstyle{every path}=[iteration, bend right=45]
  \draw (pi+j.north) to (pi+j-1.north);
  \draw (pi+j-1.north) [middle dots] to (pi+1.north);
  \draw (pi+1.north) to (pi.north);
\end{scope}

\node (B) [below=2\cellheight of ai] {$i$};
\draw (ai) [arrow] -- (B);

\input{_footer.tex}
