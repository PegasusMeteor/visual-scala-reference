\input{_header.tex}

\matrix (A) [collection] {
    \node (a1)   {$a_1$};     &
    \node (a2)   {$a_2$};     &
    \node (a3)   {$a_3$};     &
    \ellipsis                 &
    \node (ai)   {$a_i$};     &
    \node (ai+1) {$a_{i+1}$}; &
    \ellipsis                 &
    \node (an)   {$a_n$};     \\
};

\foreach \i/\k in {
  1/k_1,
  2/k_2,
  3/k_1,
  i/k_m,
  i+1/k_2,
  n/k_m}
{
  \node (fa\i) [predicate, below=0.5em of a\i, pin={[function result, pin position=below] $\k$}] {$\param{f}(a_{\i})$};
  \draw (a\i) -- (fa\i);
}

\node (R) [single arrow, draw, single arrow tip angle=45, single arrow head extend=1mm, right=1cm of A] {$\quad$};

\matrix (K) [map keys, right=1cm of R] {
  \node (k1) {$k_1$}; \\
  \node (k2) {$k_2$}; \\
  \vellipsis          \\
  \node (km) {$k_m$}; \\
};

\matrix (K1) [map values, right=1cm of k1.east] {
  \node             {$a_1$};  &
  \node             {$a_3$};  &
  \ellipsis[12.5mm]           \\
};

\matrix (K2) [map values, right=1cm of k2.east] {
  \node             {$a_2$};     &
  \ellipsis[12.5mm]              &
  \node             {$a_{i+1}$}; &
  \ellipsis[12.5mm]              \\
};

\matrix (Km) [map values, right=1cm of km.east] {
  \ellipsis[12.5mm]          &
  \node             {$a_i$}; &
  \ellipsis[12.5mm]          &
  \node             {$a_n$}; \\
};

\draw (k1) [map to] -- (K1);
\draw (k2) [map to] -- (K2);
\draw (km) [map to] -- (Km);

\input{_footer.tex}
